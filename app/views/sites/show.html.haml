- @title = @site.name
- @menu_title = "#{@project.name} #{@title}"

= render "projects/side_nav"

- content_for :header do
  .background-gradient
  .header-container
    .container
      %h1.page-heading
        .float-right
          .dropdown
            = link_to "#", class: "btn btn-light dropdown-toggle", data: { toggle: "dropdown" } do
              Actions
              %strong.caret

            %ul.dropdown-menu.dropdown-menu-right
              %li
                = link_to project_subjects_path(@project, site_id: @site.id) do
                  %i.fa.fa-eye
                  View Subjects
              - if current_user.all_sites.pluck(:id).include?(@site.id)
                %li
                  = link_to edit_project_site_path(@site.project, @site) do
                    %i.fa.fa-pencil
                    Edit
                %li.divider{ role: "separator" }
                %li
                  = link_to [@project, @site], method: :delete, data: { confirm: "Delete #{@site.name}?" } do
                    .text-danger
                      %i.fa.fa-trash
                      Delete
        = @title

.dashboard-container
  %table.table.table-borderless
    %col.d-none.d-sm-table-column{ width: "30%" }
    %col.d-table-column.d-sm-none{ width: "50%" }
    %tr
      %th Name
      %td= @site.name

    - if @site[:short_name].present?
      %tr
        %th Short Name
        %td= @site.short_name
    %tr
      %th Number
      %td= @site.number
    %tr
      %th
        = @site.project.subject_code_name_full
        Format
      %td
        - if @site.subject_code_format.present?
          %code= @site.subject_code_format
    %tr
      %th Description
      %td= simple_format @site.description

    %tr
      %th Site Members
      - if @site.site_users.blank?
        %td
          %span.text-muted No Site Members
    - if @site.site_users.present?
      %table.table.table-striped.table-borderless.table-hover
        %col
        %col
        - if @project.blinding_enabled?
          %col
        %col.hidden-xs
        %col{ width: "1px" }
        %thead
          %tr
            %th Name
            %th Role
            - if @project.blinding_enabled?
              %th.text-center Blinding
            %th.hidden-xs Invited By
            %th.text-center Actions
        - @site.site_users.includes(:user, :creator).order(editor: :desc, id: :asc).each do |member|
          = render "projects/member_row", member: member
