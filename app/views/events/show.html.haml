- @title = @event.name
- @menu_title = "#{@project.name} #{@title}"

= render 'projects/side_nav'

- content_for :header do
  .background-gradient
  .header-container
    .container
      %h1.page-heading
        .pull-right
          .dropdown
            = link_to '#', class: 'btn btn-default dropdown-toggle', data: { toggle: 'dropdown' } do
              Actions
              %strong.caret

            %ul.dropdown-menu.dropdown-menu-right
              %li
                = link_to edit_project_event_path(@event.project, @event) do
                  %span.glyphicon.glyphicon-edit
                  Edit
              %li.divider{ role: 'separator' }
              %li
                = link_to [@project, @event], method: :delete, data: { confirm: "Are you sure you want to delete Event #{@event.name}?" } do
                  .text-danger
                    %span.glyphicon.glyphicon-trash
                    Delete

        = render 'layouts/side_nav_header_button'
        = @title
        = render 'layouts/unblinded_only', project: @project, object: @event, placement: 'top'

.dashboard-container
  %table.table.table-borderless
    %col.hidden-xs{ width: '30%' }
    %col.hidden-sm.hidden-md.hidden-lg{ width: '50%' }

    %tr
      %th Slug
      %td= @event.slug

    %tr
      %th Position
      %td= @event.position

    %tr
      %th Description
      %td= simple_format @event.description

    %tr
      %th User
      %td= link_to @event.user.name, @event.user if @event.user

    %tr
      %th Archived
      %td= simple_check @event.archived

    %tr
      %th Information
      %td
        - assigned_count = @event.subject_events.with_current_subjects.count
        = pluralize assigned_count, 'event'
        assigned for
        - assigned_subject_count = @event.subject_events.with_current_subjects.pluck(:subject_id).uniq.count
        = pluralize assigned_subject_count, 'subject'

        - subject_count = @project.subjects.count

  %table.table.table-fixed.table-striped
    %thead
      %tr
        %th
        - if @project.handoffs_enabled?
          %th
        %th.center{ colspan: 3 } Assigned  (# of Subjects)
        %th.center Unassigned  (# of Subjects)
      %tr
        %th Design
        - if @project.handoffs_enabled?
          %th Handoff Enabled
        %th.center Entered
        %th.center Set as Missing
        %th.center Unentered
        %th
    - @event.event_designs.includes(:design).each do |event_design|
      - design = event_design.design
      %tr
        %td
          = link_to design.name, [@project, design]
        - if @project.handoffs_enabled?
          %td= simple_check_new event_design.handoff_enabled?
        %td.center
          - entered_count = @project.subjects.with_entered_design_on_event(design, @event).count
          - if entered_count > 0
            = link_to entered_count, project_subjects_path(@project, on_event_design_id: design.id, event_id: @event.id)
            - if subject_count > 0
              %span.text-muted{ style: "font-size:0.7em" }
                = "#{(entered_count * 100.0 / subject_count).round}%"
        %td.center
          - missing_count = @project.subjects.with_missing_design_on_event(design, @event).count
          - if missing_count > 0
            = link_to missing_count, project_subjects_path(@project, on_event_design_id: design.id, event_id: @event.id)
            - if subject_count > 0
              %span.text-muted{ style: "font-size:0.7em" }
                = "#{(missing_count * 100.0 / subject_count).round}%"
        %td.center
          - unentered_count = assigned_subject_count - entered_count - missing_count
          - if unentered_count > 0
            = link_to unentered_count, project_subjects_path(@project, not_on_event_design_id: design.id, event_id: @event.id)
            - if subject_count > 0
              %span.text-muted{ style: "font-size:0.7em" }
                = "#{(unentered_count * 100.0 / subject_count).round}%"
          - else
            %span.text-muted -
        %td.center
          - unassigned_count = @project.subjects.without_event(@event).count
          - if unassigned_count > 0
            = link_to unassigned_count, project_subjects_path(@project, without_event_id: @event.id)
            - if subject_count > 0
              %span.text-muted{ style: "font-size:0.7em" }
                = "#{(unassigned_count * 100.0 / subject_count).round}%"
