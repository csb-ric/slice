- @title = 'My Settings'

- content_for :header do
  .header-container
    .container
      %h1.page-heading= @title

.background-gradient

.body-attachment
  .landing-lower-right
    %i.fa.fa-anchor

.row
  .col-md-6
    .panel.panel-primary
      .panel-heading
        %span.glyphicon.glyphicon-cog
        My Settings
      .panel-body
        = form_for current_user, url: settings_path, method: :post, html: { class: 'form-vertical' } do |f|
          - if current_user.errors.reject { |key, _| [:current_password, :password, :password_confirmation].include?(key) }.any?
            .callout.callout-danger
              %strong
                = pluralize current_user.errors.count, 'error'
                prohibited settings from being saved

              %ul
                - current_user.errors.full_messages.each do |message|
                  %li= message

          .form-group
            = f.label :first_name, nil, class: 'control-label'
            = f.text_field :first_name, class: 'form-control'

          .form-group
            = f.label :last_name, nil, class: 'control-label'
            = f.text_field :last_name, class: 'form-control'

          .form-group
            = f.label :email, nil, class: 'control-label'
            = f.text_field :email, class: 'form-control'

          .form-group
            = f.label :emails_enabled, 'Email Settings'
            .checkbox
              %label
                = f.check_box :emails_enabled
                Allow
                = ENV['website_name']
                to send you emails.
              = link_to '#', class: 'btn btn-xs btn-default', tabindex: '-1', data: { object: 'toggle-visibility', target: "#email_information"} do
                %span.glyphicon.glyphicon-info-sign

            #email_information.callout.callout-info{ style: 'display: none' }
              Unchecking this box will disable all emails. You will still receive emails for:
              %ul
                %li Password reset emails

          .form-group
            = f.label :theme, 'Theme', class: 'control-label'
            = f.select :theme, Slice::THEMES, { include_blank: 'Default' }, class: 'form-control'

          - if false
            .form-group
              = f.label :beta_enabled, 'Beta Preview'
              .checkbox
                %label
                  = f.check_box :beta_enabled
                  Enable Beta Preview

          .form-group.submit-btn-container
            = f.submit 'Save Settings', class: 'btn btn-accent btn-shadow'

  .col-md-6
    .panel.panel-primary
      .panel-heading
        %span.glyphicon.glyphicon-lock
        Change Password
      .panel-body
        = form_for current_user, url: change_password_path, method: :patch, html: { id: 'reset_password', class: 'form-vertical' } do |f|
          - if current_user.errors.any?
            .callout.callout-danger
              %strong
                = pluralize current_user.errors.count, 'error'
                prohibited this password from being saved

              %ul
                - current_user.errors.full_messages.each do |msg|
                  %li= msg

          .form-group
            = f.label :current_password, 'Current Password', class: 'control-label'
            = f.password_field :current_password, class: 'form-control', autocomplete: 'off'
          .form-group
            = f.label :password, 'New Password', class: 'control-label'
            = f.password_field :password, class: 'form-control', autocomplete: 'off'

          .form-group
            = f.label :password, 'Password Confirmation', class: 'control-label'
            = f.password_field :password_confirmation, class: 'form-control', autocomplete: 'off'

          .form-group
            = link_to 'Update Password', '#', class: 'btn btn-accent btn-shadow', data: { object: 'settings-save', target: '#reset_password' }
      .panel-footer
        - if current_user.password_expires_in > 0
          Your password will expire in
          = pluralize current_user.password_expires_in, 'day'
          on
          = current_user.password_expires_on.strftime('%a, %B %-d, %Y.')
        - else
          Your password has expired.

    .panel.panel-primary
      .panel-heading
        My Profile Picture
      .panel-body
        .center= image_tag current_user.avatar_url(80, 'identicon'), class: 'img-rounded'
        .callout.callout-accent{ style: 'margin-bottom:0' }
          You can change your picture at
          = link_to 'gravatar.com', 'http://gravatar.com', class: 'callout-link'
