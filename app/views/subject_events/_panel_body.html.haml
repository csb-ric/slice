%table.table.table-striped.table-borderless.table-hover{ style: "margin-bottom: 0;" }
  %col{ width: "60px" }
  %col
  - subject_event.event.event_designs.includes(:design).each do |event_design|
    - design = event_design.design
    - next if current_user.all_viewable_designs.where(id: design.id).count == 0

    - sheets = @subject.sheets.where(subject_event_id: subject_event.id, design_id: design.id)

    - if sheets.present?
      - sheets.each do |sheet|
        %tr{ class: "#{"warning" if sheets.count > 1 && event_design.highlight_duplicates?} #{"highlight" if @sheet == sheet}", data: { object: sheet.missing? ? nil : "sheet-draggable", sheet_id: sheet.id, sheet_name: sheet.name, subject_event_id: sheet.subject_event_id }, style: sheet.missing? ? nil : "cursor: move;" }
          %td
            - if sheet.missing?
              %span.label.label-default{ rel: "tooltip", title: "Marked as Missing", data: { container: "body", placement: "right" } } M
            - else
              %span{ id: "sheet_#{sheet.id}_coverage" }= render "sheets/coverage", sheet: sheet
          %td
            .pull-right
              - if sheet.missing?
                .dropdown
                  = link_to "#", class: "btn btn-default btn-xs dropdown-toggle", data: { toggle: "dropdown" } do
                    Actions
                    %strong.caret

                  %ul.dropdown-menu.dropdown-menu-right
                    %li
                      = link_to set_as_not_missing_project_sheet_path(@project, sheet), method: :post, remote: true do
                        Set as Not Missing
              - else
                - if sheet.comments_count.positive?
                  = succeed " " do
                    = link_to project_sheet_path(@project, sheet), class: "btn btn-xs btn-accent" do
                      = sheet.comments_count
                      %i.fa.fa-comment
              - if sheets.count > 1 && event_design.highlight_duplicates?
                %i.fa.fa-exclamation-triangle.text-warning{ rel: "tooltip", title: "Duplicate Entry", data: { placement: "left", container: "body" } }
              - if sheets.count > 1
                %span.hidden-sm.hidden-md.hidden-lg.nowrap= sheet.created_at.strftime("%b %-d, %Y")
                %span.hidden-xs.nowrap= sheet.created_at.strftime("%a, %b %-d, %Y")
            - if event_design.handoff_enabled?
              %span.label.label-accent.hidden-xs Handoff
              %span.label.label-accent.hidden-sm.hidden-md.hidden-lg H
            = link_to_if !sheet.missing?, sheet.name, project_sheet_path(@project, sheet)
            = render "layouts/unblinded_only", project: @project, object: design, placement: "top"
            - unless event_design.required?(@subject)
              %span.text-warning{ rel: "tooltip", data: { title: "Not Required", container: "body", placement: "right" } } *
    - elsif event_design.required?(@subject)
      %tr
        %td
          - if @subject.editable_by?(current_user)
            = link_to new_data_entry_project_subject_path(@project, @subject, design, sheet: { subject_event_id: subject_event.id }), class: "btn btn-xs btn-accent btn-shadow" do
              %i.fa.fa-plus{ aria: { hidden: "true" } }
        %td
          - if @subject.editable_by?(current_user)
            .pull-right
              .dropdown
                = link_to "#", class: "btn btn-default btn-xs dropdown-toggle", data: { toggle: "dropdown" } do
                  Actions
                  %strong.caret

                %ul.dropdown-menu.dropdown-menu-right
                  %li
                    = link_to new_data_entry_project_subject_path(@project, @subject, design, sheet: { subject_event_id: subject_event.id }) do
                      / %i.fa.fa-plus
                      Create Sheet
                  %li.divider{ role: "separator" }
                  %li
                    = link_to set_sheet_as_missing_project_subject_path(@project, @subject, design, subject_event), method: :post, remote: true do
                      / %i.fa.fa-trash
                      Set as Missing
          - if event_design.handoff_enabled?
            %span.label.label-accent.hidden-xs Handoff
            %span.label.label-accent.hidden-sm.hidden-md.hidden-lg H
          - if @subject.editable_by?(current_user)
            = link_to design.name, new_data_entry_project_subject_path(@project, @subject, design, sheet: { subject_event_id: subject_event.id })
          - else
            = design.name
          = render "layouts/unblinded_only", project: @project, object: design, placement: "top"
- non_design_sheets = subject_event.extra_sheets_on_subject_event(current_user)
- if non_design_sheets && non_design_sheets.count > 0
  %table.table.table-striped.table-borderless.table-hover{ style: "margin-bottom: 0;" }
    %col{ width: "60px" }
    %col
    - non_design_sheets.each do |sheet|
      %tr{ class: "#{"highlight" if @sheet == sheet}", data: { object: "sheet-draggable", sheet_id: sheet.id, sheet_name: sheet.name, subject_event_id: sheet.subject_event_id }, style: "cursor: move;" }
        %td{ id: "sheet_#{sheet.id}_coverage" }= render "sheets/coverage", sheet: sheet
        %td
          .pull-right
            - if sheet.comments_count.positive?
              = link_to project_sheet_path(@project, sheet), class: "btn btn-xs" do
                = sheet.comments_count
                %i.fa.fa-comment

          %span.label.label-warning.hidden-xs{ rel: "tooltip", title: "Not on base event", data: { placement: "bottom", container: "body" } } Extra
          %span.label.label-warning.hidden-sm.hidden-md.hidden-lg{ rel: "tooltip", title: "Not on base event", data: { placement: "bottom", container: "body" } } E
          = link_to sheet.name, project_sheet_path(@project, sheet)
