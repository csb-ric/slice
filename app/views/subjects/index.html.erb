<% @title = 'Subjects' %>
<div class="page-header">
  <h1>
    <%= link_to @project.name, @project %> &middot; <%= @title %>
    <%= link_to "Create Subject", new_project_subject_path(@project), class: 'btn btn-xs btn-primary' if @project.can_edit_sheets_and_subjects?(current_user) %>
    <%= link_to "Subject Report", subject_report_project_path(@project), class: 'btn btn-default btn-xs' %>
    <%= link_to "Subject Report by Schedule", report_project_subjects_path(@project), class: 'btn btn-default btn-xs' %>
  </h1>
</div>

<%= form_tag project_subjects_path(@project), method: :get, id: "subjects_search", class: 'form-vertical' do %>
  <%= hidden_field_tag :order, params[:order] %>
  <div class="row">
    <div class="col-md-4 form-group">
      <%= label :search, 'Search', class: 'col-md-2 control-label' %>
      <div class="col-md-10">
        <%= text_field_tag 'search', params[:search], class: 'form-control' %>
      </div>
    </div>

    <div class="col-md-4 form-group">
      <label class="col-md-2 control-label">Subjects</label>
      <div class="col-md-10">
        <%= render partial: 'layouts/checkbox_button_group', locals: { name: 'statuses', options: Subject::STATUS, selected: @statuses, target: '#subjects_search' } %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 form-group" id="select_site">
      <%= label :site_id, 'Site', class: 'col-md-2 control-label' %>
      <div class="col-md-10">
        <%= select_tag :site_id, options_for_select([['---', nil]] + current_user.all_viewable_sites.where( project_id: @project.id ).order('name').collect{|s| [s.name, s.id]}, params[:site_id] ), class: 'form-control' %>
      </div>

    </div>

    <div class="col-md-4 form-group" id="select_design">
      <%= label :without_design_id, 'Without Design', class: 'col-md-2 control-label' %>
      <div class="col-md-10">
        <%= select_tag :without_design_id, options_for_select([['---', nil]] + @project.designs.order('name').collect{|d| [d.name, d.id]}, params[:without_design_id] ), class: 'form-control' %>
      </div>
    </div>


    <% if event = @project.events.find_by_id(params[:without_event_id]) and schedule = @project.schedules.find_by_id(params[:without_schedule_id]) %>
      <div class="col-md-4 form-group">
        <label class="col-md-2 control-label">Without</label>
        <div class="col-md-10">
          <%= schedule.name %> &middot; <%= event.name %>
          <%= hidden_field_tag :without_event_id, params[:without_event_id] %>
          <%= hidden_field_tag :without_schedule_id, params[:without_schedule_id] %>
        </div>
      </div>
    <% end %>

  </div>

  <div class="form-group">
    <div class="col-md-10 col-md-offset-2">
      <%= submit_tag 'Search', class: 'btn btn-primary', name: nil %>
      <%= link_to 'Reset', project_subjects_path(@project), class: 'btn btn-default' %>
    </div>
  </div>
<% end %>

<%= render partial: 'subjects/subjects' %>
