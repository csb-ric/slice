%h1
  %span.glyphicon.glyphicon-object-align-horizontal
  = @subject.subject_code

- if false
  %p
    - if current_user.all_subjects.pluck(:id).include?(@subject.id)
      = link_to "Edit Subject", edit_project_subject_path(@subject.project, @subject), class: 'btn btn-default btn-xs'
      = link_to "Delete Subject", [@subject.project, @subject], method: :delete, class: 'btn btn-xs btn-danger-inverse', data: { confirm: "Are you sure you want to delete Subject #{@subject.name}?" }

- if @subject.subject_events.count == 0
  %h2
    Launch Event

  .row
    - if event = @project.events.where(scheduled: true, archived: false).order(:position).first
      .col-sm-6{ style: 'margin-bottom:20px' }
        = link_to put_a_subject_on_an_event_project_subject_path(@project, @subject, event_id: event.to_param), method: :get, class: 'btn btn-success-inverse btn-block btn-lg' do
          .text-muted Initial Event
          %span.glyphicon.glyphicon-plus
          New
          %strong.btn-text-emphasis= event.name

    .col-sm-6{ style: 'margin-bottom:20px' }
      = link_to choose_an_event_for_subject_project_subject_path(@project, @subject), method: :get, class: 'btn btn-success-inverse btn-block btn-lg' do
        .text-muted More Events
        %span.glyphicon.glyphicon-eye
        Show me
        %strong.btn-text-emphasis other events
        !
- else
  .row
    .col-xs-3{ style: 'border: 1px solid blue;padding:0px' }
      - @subject.subject_events.each_with_index do |subject_event, index|
        .black-box{ class: "#{'active' if index == 0}", style: "background-color: black;color: white;padding:10px;#{'background-color:orange' if index == 0}" }
          - sheets_started = sheets_completed = @subject.sheets.where(subject_event_id: subject_event.id, design_id: subject_event.event.designs.pluck(:id)).count
          - designs_count = subject_event.event.designs.count
          - if sheets_completed == designs_count
            %span.text-success
              %span.glyphicon.glyphicon-ok
          - elsif sheets_started == 0
            %span.text-muted
              %span.glyphicon.glyphicon-tasks
          - else
            %span.text-warning
              %span.glyphicon.glyphicon-tasks
          = link_to "#subject_event_#{subject_event.id}", data: { toggle: 'tab' } do
            = subject_event.event.name
      .black-box{ style: "background-color: black;color: white;padding:10px;" }
        = link_to '#add-event', "aria-controls" => 'add-event', data: { toggle: 'tab' } do
          +
          Add New Event
      .black-box{ style: "background-color: black;color: white;padding:10px;" }
        = link_to '#history', "aria-controls" => 'history', data: { toggle: 'tab' } do
          +
          SUBJECT TIMELINE AND HISTORY
          (the epic tale)
    .col-xs-9{ style: 'border: 1px solid red' }
      %div{ role: "tabpanel", style: 'margin-bottom:20px' }
        .tab-content
          .tab-pane#add-event{ role: "tabpanel" }
            - if true
              = render partial: 'subjects/beta/choose_event'
            - else
              .row
                .col-sm-offset-3.col-sm-6{ style: '' }
                  .center{ style: 'margin-bottom:20px;margin-top: 20px' }
                    = link_to choose_an_event_for_subject_project_subject_path(@project, @subject), method: :get, class: 'btn btn-success-inverse btn-block btn-lg' do
                      .text-muted Add More Events
                      %span.glyphicon.glyphicon-eye
                      Show me
                      %strong.btn-text-emphasis other events
                      !
          - @subject.subject_events.each_with_index do |subject_event, index|
            .tab-pane{ role: "tabpanel", class: "#{'active' if index == 0}", id: "subject_event_#{subject_event.id}", style: 'border-right:1px solid #ddd;border-bottom:1px solid #ddd;border-left:1px solid #ddd;padding:15px' }
              %p.lead=subject_event.event_date
              %ul.list-unstyled
                - subject_event.event.designs.each do |design|
                  %li
                    - sheet = @subject.sheets.where(subject_event_id: subject_event.id, design_id: design.id).first
                    - if sheet
                      = link_to design.name, edit_project_sheet_path(@project, sheet)
                      = coverage_helper(sheet)
                    - else
                      = design.name
                      = link_to 'get started', new_project_sheet_path(@project, sheet: { design_id: design.id, subject_event_id: subject_event.id }, subject_code: @subject.subject_code, subject_acrostic: @subject.acrostic, site_id: @subject.site_id)
          .tab-pane#history{ role: "tabpanel" }
            %p.lead.center
              Awesome! Today
              %strong Remo M
              added a new event to the subject!
            %p.lead.text-muted.center
              This subject has no history. No European history, no American history, no ancient history. Nada.
            %p.lead.text-muted.center
              For all we know, nothing happened before this subject was created. However, on
              = @subject.created_at
              our subject came into existence. And Slice became a better place.
          - if false
            .tab-pane#settings{ role: "tabpanel" }
              Settings



- if false
  %h2
    Subject Events Listed and Assigned

  - @subject.subject_events.each do |subject_event|
    %h3=subject_event.event.name
    %p.lead=subject_event.event_date
    %ul.list-unstyled
      - subject_event.event.designs.each do |design|
        %li
          = design.name
          - sheet = @subject.sheets.where(subject_event_id: subject_event.id, design_id: design.id).first
          - if sheet
            = coverage_helper(sheet)
            = link_to 'edit me now', edit_project_sheet_path(@project, sheet)
          - else
            = link_to 'get started', new_project_sheet_path(@project, sheet: { design_id: design.id, subject_event_id: subject_event.id }, subject_code: @subject.subject_code, subject_acrostic: @subject.acrostic, site_id: @subject.site_id)

