<% @title = "Subject: #{@subject.name}" %>
<div class="page-header">
  <h1>
    <%= link_to @project.name, @project %> &middot; <%= @title %>
    <% if current_user.all_subjects.pluck(:id).include?(@subject.id) %>
      <%= link_to "Edit Subject", edit_project_subject_path(@subject.project, @subject), class: 'btn btn-mini' %>
      <%= link_to "Delete Subject", [@subject.project, @subject], method: :delete, class: 'btn btn-mini btn-danger', data: { confirm: "Are you sure you want to delete Subject #{@subject.name}?" } %>
    <% end %>
    <%= link_to "View Subjects", project_subjects_path, class: 'btn btn-mini' %>
    <%= link_to "Subject Report", subject_report_project_path(@project), class: 'btn btn-mini' %>
  </h1>
</div>

<dl class="dl-horizontal">
  <dt>Subject Code</dt>
  <dd><%= @subject.subject_code %></dd>

  <% if @subject.project.acrostic_enabled? %>
    <dt>Acrostic</dt>
    <dd><%= @subject.acrostic %></dd>
  <% end %>

  <dt>Email</dt>
  <dd><%= @subject.email %></dd>

  <dt>Status</dt>
  <dd><%= status_helper(@subject, true) %></dd>

  <dt>Site</dt>
  <dd><%= link_to @subject.site.name, [@subject.site.project, @subject.site] if @subject.site %></dd>

  <dt>Creator</dt>
  <dd><%= link_to @subject.user.name, @subject.user if @subject.user %></dd>

  <dt>Sheets</dt>
  <dd>
    <ul>
      <% @subject.sheets.order(:study_date).each do |sheet| %>
        <li><%= simple_date sheet.study_date %> - <%= link_to sheet.name, [sheet.project, sheet] %></li>
      <% end %>
    </ul>
  </dd>
</dl>

<% @subjects = Subject.current.where(id: @subject.id) %>
<% @designs = @project.designs %>
<%= render partial: 'projects/subject_report' %>


<% sheet_variables = @subject.sheets.collect{|s| s.sheet_variables.with_variable_type('file')}.flatten[0..100] %>
<% if sheet_variables.size > 0 %>
<h2>Files</h2>
<form class="form-horizontal">
<% sheet_variables.each do |sheet_variable| %>
  <%= @sheet = sheet_variable.sheet; @variable = sheet_variable.variable; render partial: 'variables/show' %>
<% end %>
</form>
<% end %>
