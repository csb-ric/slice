<% @title = @design.name %>
<div class="page-header">
  <h1>
    <%= link_to @project.name, @project %> &middot; <%= link_to 'Designs', project_designs_path(@project) %> &middot; <%= @title %>
  </h1>
  <% if @design.editable_by?(current_user) %>
    <%= link_to "Edit Design", edit_project_design_path(@design.project, @design), class: 'btn btn-default btn-mini' %>
    <%= link_to "Delete Design", [@design.project, @design], method: :delete, class: 'btn btn-mini btn-danger-inverse', data: { confirm: "Are you sure you want to delete Design #{@design.name}?" } %>
    <%= link_to "Reimport", reimport_project_design_path(@design.project, @design), class: 'btn btn-default btn-mini' %>
    <%= link_to "Copy Design", copy_project_design_path(@design.project, @design), class: 'btn btn-default btn-mini' %>
  <% end %>
  <%= link_to "PDF", print_project_design_path(@design.project, @design, format: 'pdf'), target: '_blank', class: 'btn btn-default btn-mini' %>
  <%= link_to "View Sheets", project_sheets_path(@project, design_id: @design.id), class: 'btn btn-default btn-mini' %>

  <%= link_to "Report", report_project_design_path(@design.project, @design), class: 'btn btn-default btn-mini' %>
  <%= link_to "Overview", overview_project_design_path(@design.project, @design), class: 'btn btn-default btn-mini' %>
</div>

<% if @design.publicly_available? or @design.total_rows > 0 %>
  <dl class="dl-horizontal">
    <% if @design.publicly_available? %>
      <dt>Publicly Available</dt>
      <dd>
        <% if @design.slug.blank? %>
          <%= link_to "#{SITE_URL}/projects/#{@design.project_id}/surveys/#{@design.id}", "#{SITE_URL}/projects/#{@design.project_id}/surveys/#{@design.id}", class: 'input-xxlarge' if @design.publicly_available? %>
        <% else %>
          <%= link_to "#{SITE_URL}/survey/#{@design.slug}", "#{SITE_URL}/survey/#{@design.slug}", class: 'input-xxlarge' if @design.publicly_available? %>
        <% end %>
      </dd>
    <% end %>

    <% if @design.total_rows > 0 %>
      <dt>Import Progress</dt>
      <dd id="progress" data-object="<%= 'ajax-timer' if @design.total_rows != @design.rows_imported %>" data-path="<%= progress_project_design_path(@design.project, @design) %>">
        <%= render partial: 'designs/progress' %>
      </dd>
    <% end %>
  </dl>
<% end %>

<ul class="pagination">
  <li><a href="#" id="sections_link">Sections</a></li>
  <li class="active"><a href="#"><%= @design.section_names.count %></a></li>
</ul>

<ul class="pagination">
  <li class="disabled"><a href="#" id="variables_link">Variables</a></li>
  <li class="active"><a href="#"><%= @design.variable_ids.count %></a></li>
</ul>

<%= link_to 'Save Order', '#', id: 'reorder_design_button', class: 'btn btn-primary btn-mini', disabled: 'disabled', style: 'display:inline-block; margin:22px 0px;vertical-align:top' %>
<%= link_to 'Save Order', '#', id: 'reorder_design_sections_button', class: 'btn btn-primary btn-mini', disabled: 'disabled', style: 'display:inline-block; margin:22px 0px;vertical-align:top;display:none' %>

<div class="modal hide" id="saving_modal">
  <div class="modal-header">
    <h3>Reordering Design</h3>
  </div>
  <div class="modal-body">
    <p>Your changes to the design are being saved...this shouldn't take longer than a minute.</p>
  </div>
</div>

<div id="compact_design_container">
  <%= render partial: 'compact_design' %>
</div>

<div id="reorder_sections_container" style="display:none">
  <%= render partial: 'reorder_sections' %>
</div>

<%= hidden_field_tag 'sheet[project_id]', @project.id %>
<form class="form-horizontal" id="design">
  <div class="center"><%= image_tag 'contour/ajax-loader.gif' %></div>
</form>

<%= form_tag selection_project_designs_path(@design.project, sheet: { design_id: @design.id }), remote: true, method: :post, data: { object: 'form-load' }, id: 'new_sheet' do %>
<% end %>
