<% missing_responses = responses.select{|r| r.blank?} %>
<% valid_responses = responses.select{|r| not r.blank?}.map(&:to_i) %>

<table class="table">
  <thead>
    <tr>
      <th>N</th>
      <% @variable.options_missing_at_end.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
        <th><%= value %>: <%= name %></th>
      <% end %>
      <th class="muted">Unknown</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <%= filter_link(Sheet.array_count(valid_responses), @project, @design, @variable, ':any', @statuses) %>
      </td>
      <% @variable.options_missing_at_end.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
        <td>
          <%= filter_link(responses.select{|r| r == value}.count == 0 ? nil : responses.select{|r| r == value}.count, @project, @design, @variable, value, @statuses) %>
        </td>
      <% end %>
      <td><%= filter_link(Sheet.array_count(missing_responses), @project, @design, @variable, ':missing', @statuses) %></td>
      <td><%= filter_link(Sheet.array_count(responses), @project, @design, nil, nil, @statuses) %></td>
    </tr>
  </tbody>
</table>
