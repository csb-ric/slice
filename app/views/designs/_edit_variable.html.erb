<% position = Time.now.to_i.to_s + Time.now.usec.to_s %>
<div id="variable_<%= position %>" class="<%= 'fieldset_with_errors' if @design.errors.keys.include?(:variables) %> well">
  <div class="page-header" style="margin-top:0px"><h3>Variable <%= link_to 'Remove', "#", data: { object: 'remove', target: "variable_#{position}" }, class: 'btn btn-mini btn-danger' %></h3></div>

  <div class="control-group">
    <%= label_tag "design_option_tokens_#{position}_variable_id", 'Variable', class: 'control-label' %>
    <div class="controls">
      <%= select_tag "design[option_tokens][#{position}][variable_id]", options_for_select([['---', nil]] + current_user.all_viewable_variables.order(:project_id, :name).collect{|v| [v.name_with_project, v.id]}, @option[:variable_id]), style: 'width:99%', data: { object: 'variable-load', position: position } %>
      <div id="design_<%= position %>_variable_preview" class="well">
        <% @variable = current_user.all_viewable_variables.find_by_id(@option[:variable_id]) %>
        <%= render partial: 'designs/variable' if @variable %>
      </div>
    </div>
  </div>

  <div class="control-group">
    <%= label_tag "design_option_tokens_#{position}_condition", 'Show If', class: 'control-label' %>
    <div class="controls">
      <%= select_tag "design[option_tokens][#{position}][condition_variable_id]", options_for_select([['---', nil]] + current_user.all_viewable_variables.order(:project_id, :name).collect{|v| [v.name_with_project, v.id]}, @option[:condition_variable_id]), style: 'width:99%', data: { object: 'variable-load', position: position } %> has value:
      <%= text_field_tag "design[option_tokens][#{position}][condition_value]", @option[:condition_value] %>
    </div>
  </div>
</div>

<%= javascript_tag do %>
$('[data-object~="variable-load"]').change( function(){
  retrieveVariable(<%= escape_javascript(position) %>);
  return false;
});
<% end %>
