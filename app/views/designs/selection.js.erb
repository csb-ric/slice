$("#design").html("<%= escape_javascript(render("designs/selection")) %>");
$('.timepicker').timepicker({ 'timeFormat': 'H:i:s' });
$('.chzn-select').chosen({ allow_single_deselect: true });
$(".datepicker").datepicker({
  showOtherMonths: true,
  selectOtherMonths: true,
  changeMonth: true,
  changeYear: true
});
$("#ui-datepicker-div").hide();

$('[data-object~="variable-typeahead"]').each(function() {
  var $this = $(this);
  $this.typeahead({
    source: function(query, process) {
      var variable_id = $this.data('variable-id');
      return $.get(root_url + 'variables/' + variable_id + '/typeahead', {
        query: query
      }, function(data) {
        return process(data);
      });
    }
  });
});

<% if @design and params[:current_design_page].to_i < @design.total_pages %>
  $('#sheet_submit_btn').val('Next Page');
<% elsif @sheet.new_record? %>
  $('#sheet_submit_btn').val('Create Sheet');
<% else %>
  $('#sheet_submit_btn').val('Update Sheet');
<% end %>

$('#sheet_submit_btn').data('page', '<%= params[:current_design_page].to_i + 1 %>');

$("[rel~=popover]").popover({ offset: 10, trigger: 'focus' });

<% if @design %>

  <% @design.options.each do |option| %>
    <% @option = option %>
    <% if @option[:variable_id].blank? %>
      $('#<%= @option[:section_id] %>').data('branching-logic', <%= raw @design ? @design.branching_logic_section(@option[:section_id]) : ''.to_json %>);
    <% elsif @variable = Variable.current.find_by_id(@option[:variable_id]) %>
      $('#varvar_<%= @variable.id %>').data('values-hash', <%= raw @design ? @design.values_hash(@variable) : [].to_json %>);
      $('#varvar_<%= @variable.id %>').data('branching-logic', <%= raw @design ? @design.branching_logic(@variable) : ''.to_json %>);
    <% end %>
  <% end %>
<% end %>

updateAllVariables();
updateCalculatedVariables();

$('[data-spy="scroll"]').each(function () {
  var $spy = $(this).scrollspy('refresh')
});
