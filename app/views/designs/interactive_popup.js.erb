$("#design_id").val("<%= @design.id %>");
<% if not @design.new_record? and @modify_url %>
if(browserSupportsPushState){
  window.history.pushState("interactive", "Editing Design", '<%= interactive_project_designs_path(@project, design_id: @design) %>');
}else{
  window.location.href = '<%= interactive_project_designs_path(@project, design_id: @design) %>';
}
<% end %>

<% if ['design_name', 'design_description', 'section', 'variable_header', 'variable_display_name', 'variable_prepend', 'variable_append', 'variable_units', 'variable_calculated', 'variable_ranges', 'variable_autocomplete', 'variable_date', 'variable_domain'].include?(params[:edit]) %>
  $("#interactive-design-container").html("<%= escape_javascript(render("designs/interactive/form/#{params[:edit]}")) %>");
  showContourModal();
  $("#interactive-design-container").find('input, textarea').first().focus();
<% elsif ['section_or_variable', 'new_variable', 'new_section'].include?(params[:new]) %>
  $("#interactive-design-container").html("<%= escape_javascript(render("designs/interactive/#{params[:new]}_popup")) %>");
  showContourModal();
<% elsif ['design_name', 'design_description'].include?(params[:update]) %>
  $("#<%= params[:update] %>-container").html("<%= escape_javascript(render("designs/interactive/show/#{params[:update]}")) %>");
  $("#design-sections-and-variables-container").html("<%= escape_javascript(render("designs/interactive/show/sections_and_variables")) %>");
  hideContourModal();
<% elsif (params[:variable] and params[:variable][:alignment]) or ['domain'].include?(params[:update]) or ['section', 'variable', 'domain'].include?(params[:create]) or ['section', 'variable'].include?(params[:delete]) %>
  $("#design-sections-and-variables-container").html("<%= escape_javascript(render("designs/interactive/show/sections_and_variables")) %>");
  hideContourModal();
<% elsif ['section', 'variable'].include?(params[:update]) %>
  <% @position = params[:position].to_i %>
  <% @option = @design.options[@position] %>
  <% if @variable = @design.variable_at(@position) %>
    $("#interactive_<%= params[:position] %>_container").html("<%= escape_javascript(render("designs/interactive/show/variable")) %>");
  <% else %>
    $("#interactive_<%= params[:position] %>_container").html("<%= escape_javascript(render("designs/interactive/show/section")) %>");
  <% end %>
  hideContourModal();
<% else %>
  hideContourModal();
<% end %>

$(".chzn-select").chosen({ allow_single_deselect: true });
<% if ['variable_domain'].include?(params[:edit]) %>
  $('#options[data-object~="sortable"]').sortable({ placeholder: "well alert alert-block" });
  loadColorSelectors();
<% end %>
