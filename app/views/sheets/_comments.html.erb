<div class="page-header">
  <h2>Comments</h2>
</div>

<div>
  <%= form_tag comments_path(sheet_id: @sheet.id), method: :post, remote: true, id: "sheet_#{@sheet.id}_comment_form" do %>
    <%= text_area_tag "sheet[#{@sheet.id}][comment]", '', name: 'comment[description]', rows: 2, class: 'form-control' %>
    <%= submit_tag 'Add Comment', class: 'btn btn-primary', style: 'margin:5px 0 0 5px', data: { object: 'comment-submit', target: "#sheet_#{@sheet.id}_comment_form" } %>
  <% end %>

  <% @sheet.comments.order('created_at DESC').each do |comment| %>
    <hr class="soften" style="margin-top:5px;margin-bottom:5px" data-comment-id="<%= comment.id %>"/>
    <div style="background-color: white; padding: 5px;" class="<%= 'recently_updated' if current_user.last_sign_in_at and current_user.last_sign_in_at < comment.updated_at %>" data-comment-id="<%= comment.id %>">
      <table style="background-color: white;border: 0px"><col width="50px"/>
        <tr style="background-color: white;border: 0px">
          <td style="background-color: white;border: 0px;vertical-align:top">
            <%= image_tag comment.user.avatar_url(50, "identicon"), class: 'img-rounded' %>
          </td>
          <td style="background-color: white;border: 0px;vertical-align:top;padding-left:10px">
            <%= link_to comment.user.name, comment.user %>
            <span class="quiet" style="line-height:25px"><%= simple_time comment.created_at %></span>
            <% if comment.editable_by?(current_user) %>
              <%= link_to 'Edit', edit_comment_path(comment), class: 'btn btn-mini btn-cancel-inverse' %>
            <% end %>
            <% if comment.deletable_by?(current_user) %>
              <%= link_to 'Delete', comment, method: :delete, remote: true, class: 'btn btn-mini btn-danger-inverse', data: { confirm: "Are you sure you want to delete Comment #{comment.name}?" } %>
            <% end %>
            <div style="margin-top:5px;margin-left:20px;margin-bottom:-10px"><%= simple_markdown comment.description %></div>
          </td>
        </tr>
      </table>
    </div>

  <% end %>

  <center><%#= paginate @sheet.comments, theme: "contour" %></center>

</div>
