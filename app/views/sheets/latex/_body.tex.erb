\lhead{\textbf{<%= latex_safe @sheet.subject.subject_code %>}\\<% if @sheet.project.acrostic_enabled? %> <%= latex_safe @sheet.subject.acrostic %><% end %>}
\chead{\textbf{<%= latex_safe @sheet.project.name %>}\\ <%= latex_safe @sheet.subject.site.name %>}
\rhead{\textbf{Entered} <%= latex_safe @sheet.created_at.strftime("%B %-d, %Y") %>\\<% if @sheet.last_edited_at and @sheet.created_at.to_date != @sheet.last_edited_at.to_date %>\textbf{Updated} <%= latex_safe @sheet.last_edited_at.strftime("%B %-d, %Y") %><% end %>}
\lfoot{<%= latex_safe @sheet.design.name %>}
% \cfoot{<%= latex_safe Date.today.strftime("%B %-d, %Y") %>}
% \rfoot{\thepage\ of \pageref{LastPage}}

\section*{<%= latex_safe @sheet.design.name %>}

<%= latex_safe @sheet.design.description %> \\

<% @sheet.design.options.each_with_index do |option, index| %>
  \FloatBarrier
  <% @option = option %>

  <% if @option[:variable_id].blank? %>
    <% if @option[:section_type].to_i > 0 %>
      \subsubsection*{<%= latex_safe @option[:section_name] %>}
    <% else %>
      \subsection*{<%= latex_safe @option[:section_name] %>}
    <% end %>

    <% section = @sheet.design.sections.find_by_name( @option[:section_name] ) %>
    <% if section and section.image.url %>
      \begin{figure}[!htpb]
        \includegraphics[max width=7.5in]{<%= section.image.path %>}
      \end{figure}
    <% end %>

  <% elsif @variable = Variable.current.find_by_id(@option[:variable_id]) and @sheet.show_variable?(@option[:branching_logic]) %>
    <% if @variable.variable_type == 'grid' and sheet_variable = @sheet.sheet_variables.find_by_variable_id(@variable.id) %>

\Needspace{7\baselineskip}
\begin{addmargin}[0em]{0em}\textbf{<%= latex_safe @variable.display_name %>}\end{addmargin}

\begin{longtable}{@{\extracolsep{\fill}}<%= "p{#{14.0/[@variable.grid_variables.size, 1].max}cm}"*@variable.grid_variables.size %>@{\extracolsep{\fill}}}
<% @variable.grid_variables.each do |grid_variable| %>
  <% v = current_user.all_viewable_variables.find_by_id(grid_variable[:variable_id]) %>
  <%= latex_safe v.display_name if v %> &
<% end %>
\midrule
<% (0..sheet_variable.grids.pluck(:position).max.to_i).each do |position| %>
  <% @variable.grid_variables.each do |grid_variable| %>
    <% grid = sheet_variable.grids.find_by_variable_id_and_position(grid_variable[:variable_id], position) %>
    <% if grid %>
      <% grid_response = grid.get_response(:name) %>
      <%= latex_safe grid_response.kind_of?(Array) ? grid_response.join(', ') : grid_response %>
      &
    <% end %>
  <% end %>
<% end %>
\end{longtable}

    <% else %>

\Needspace{7\baselineskip}
\begin{addmargin}[0em]{0em}\textbf{<%= latex_safe @variable.display_name %>}\end{addmargin}

<% if @variable.variable_type == 'checkbox' %>
  <% if @sheet.get_response(@variable, :name).size == 0 %>
    \vspace{1 mm}
    \textcolor[gray]{0.5}{Unknown}
    \vspace{2 mm}
  <% else %>
    \begin{itemize}
      \setlength{\itemindent}{2.5em}
      <% @sheet.get_response(@variable, :name).each do |response| %>
        \item <%= latex_safe response %>
      <% end %>
    \end{itemize}
  <% end %>
<% elsif @variable.variable_type == 'file' and response_file = @sheet.get_response(@variable, :raw) and response_file.size > 0 %>
  <% if ['jpg', 'jpeg', 'gif', 'png'].include?(response_file.path.split('.').last.downcase) %>

  \begin{figure}[!htpb]
    \includegraphics[max width=7.5in]{<%= response_file.path %>}
    <% unless @variable.description.blank? %>
      \caption{<%= latex_safe @variable.description %>}
    <% end %>
  \end{figure}

  <% else %>
    \vspace{1 mm}
    <%= latex_safe @sheet.get_response(@variable, :name) %>
    \vspace{2 mm}
  <% end %>
<% elsif @sheet.get_response(@variable, :name).blank? %>
  \vspace{1 mm}
  \textcolor[gray]{0.5}{Unknown}
  \vspace{2 mm}
<% else %>
  \vspace{1 mm}
  <%= latex_safe @sheet.get_response(@variable, :name) %>
  \vspace{2 mm}
<% end %>

    <% end %>
  <% end %>
<% end %>

<% if @sheet.locked? %>
\Needspace{7\baselineskip}
\subsubsection*{}
\shadowbox{
This sheet was \textbf{locked} and \textbf{electronically signed} by \textbf{<%= latex_safe @sheet.last_user.name %>}<% if @sheet.last_edited_at %> on \textbf{<%= @sheet.last_edited_at.strftime("%b %d, %Y") %>} at \textbf{<%= @sheet.last_edited_at.strftime("%I:%M %p") %>}<% end %>.
}
\Needspace{7\baselineskip}
\subsubsection*{Contributors}
<%= latex_safe @sheet.contributors %>
<% end %>
\newpage
