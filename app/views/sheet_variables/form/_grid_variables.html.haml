- show_values = true unless defined?(show_values)

%tr{ id: "variable_#{variable.id}_grid_row_#{position}" }
  %td{ style: 'vertical-align: middle;' }
    %span.glyphicon.glyphicon-move.grid-handle
  - variable.deprecated_grid_variables.each do |deprecated_grid_variable_hash|
    %td
      - grid = all_grids.select{|g| g.variable_id == deprecated_grid_variable_hash[:variable_id].to_i and g.position == position}.first
      - grid = Grid.new(variable_id: deprecated_grid_variable_hash[:variable_id], position: (position).to_s.last(9)) unless grid

      -# The following line sets the response for the grid variable to that from
      -# the params hash, and if that doesn't exist, it checks if there was
      -# something stored in the database (grid variable)
      - response = ((params[:variables].present? && params[:variables][variable.id.to_s].present? && params[:variables][variable.id.to_s][position.to_s].present?) ? params[:variables][variable.id.to_s][position.to_s][deprecated_grid_variable_hash[:variable_id].to_s] : (grid ? grid.get_response(:raw) : nil))

      - if Variable::TYPE.flatten.uniq.include?(grid.variable.variable_type) && grid.variable.variable_type != 'grid'
        = render "sheet_variables/form/#{grid.variable.variable_type}", design: design, design_option: design_option, response: response, disabled: disabled, variable: grid.variable, field_name: "variables[#{variable.id}][#{position}][#{grid.variable.id}]", position: position, grid: variable, object: grid, show_values: show_values
  - if variable.multiple_rows?
    %td{ style: 'vertical-align: middle;' }
      = link_to 'Remove', '#', data: { object: 'remove', target: "#variable_#{variable.id}_grid_row_#{position}" }, class: 'btn btn-xs btn-danger-inverse', tabindex: '-1'
