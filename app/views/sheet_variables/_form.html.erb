<% sheet_variable = (@sheet ? @sheet.sheet_variables.find_by_variable_id(@variable.id) : nil) %>
<% response = (params[:variables].blank? ? (sheet_variable ? sheet_variable.response : nil) : params[:variables][@variable.id.to_s]) %>
<% case @variable.variable_type when 'dropdown' %>
  <%= select_tag "variables[#{@variable.id}]", "<option value=''></option>".html_safe + grouped_options_for_select(@variable.grouped_by_missing, response), data: { content: @variable.description, title: @variable.display_name, object: "condition", name: @variable.name }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, class: 'chzn-select', title: @variable.display_name %>
<% when 'radio' %>
  <% @variable.options_without_missing.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
    <%= radio_button_tag "variables[#{@variable.id}]", "#{value}", value == response, data: { object: "condition" }, disabled: disabled %> <label><%= value %>: <%= name %></label>
  <% end %>
  <% if @variable.options_only_missing.size > 0 %>
    <label><span class="label label-info">Missing Codes</span></label>
  <% end %>
  <% @variable.options_only_missing.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
    <%= radio_button_tag "variables[#{@variable.id}]", "#{value}", value == response, data: { object: "condition" }, disabled: disabled %> <label><%= value %>: <%= name %></label>
  <% end %>
<% when 'checkbox' %>
  <% array = YAML::load(response) rescue array = response || [] %>
  <%= hidden_field_tag "variables[#{@variable.id}][]", nil, disabled: disabled %>
  <% @variable.options_without_missing.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
    <%= check_box_tag "variables[#{@variable.id}][]", "#{value}", array.collect{|i| i.to_s}.include?(value), data: { object: "condition" }, disabled: disabled %> <label><%= value %>: <%= name %></label>
  <% end %>
  <% if @variable.options_only_missing.size > 0 %>
    <label><span class="label label-info">Missing Codes</span></label>
  <% end %>
  <% @variable.options_only_missing.collect{|opt| [opt[:name], opt[:value]]}.each do |name, value| %>
    <%= check_box_tag "variables[#{@variable.id}][]", "#{value}", array.collect{|i| i.to_s}.include?(value), data: { object: "condition" }, disabled: disabled %> <label><%= value %>: <%= name %></label>
  <% end %>
<% when 'string' %>
  <%= text_field_tag "variables[#{@variable.id}]", response, data: { content: @variable.description, title: @variable.display_name, object: "condition" }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, title: @variable.display_name %>
<% when 'text' %>
  <%= text_area_tag "variables[#{@variable.id}]", response, rows: 7, style: 'width:95%', data: { content: @variable.description, title: @variable.display_name, placement: 'bottom' }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, title: @variable.display_name %>
<% when 'integer' %>
  <div class="<% unless @variable.units.blank? %>input-append<% end %>" style="display:inline-block" data-content="<%= @variable.description_range %>" data-title="<%= @variable.display_name %>" rel="<%= 'popover' unless @variable.description_range.blank? %>">
    <%= text_field_tag "variables[#{@variable.id}]", response, data: { object: 'minmax condition', hard_minimum: @variable.hard_minimum, hard_maximum: @variable.hard_maximum, soft_minimum: @variable.soft_minimum, soft_maximum: @variable.soft_maximum, name: @variable.name, missing_codes: @variable.missing_codes, variable_type: @variable.variable_type }, disabled: disabled, rel: 'tooltip', title: @variable.display_name %>
    <% unless @variable.units.blank? %><span class="add-on"><%= @variable.units %></span><% end %>
  </div>
<% when 'numeric' %>
  <div class="<% unless @variable.units.blank? %>input-append<% end %>" style="display:inline-block" data-content="<%= @variable.description_range %>" data-title="<%= @variable.display_name %>" rel="<%= 'popover' unless @variable.description_range.blank? %>">
    <%= text_field_tag "variables[#{@variable.id}]", response, data: { object: 'minmax condition', hard_minimum: @variable.hard_minimum, hard_maximum: @variable.hard_maximum, soft_minimum: @variable.soft_minimum, soft_maximum: @variable.soft_maximum, name: @variable.name, missing_codes: @variable.missing_codes, variable_type: @variable.variable_type }, disabled: disabled, rel: 'tooltip', title: @variable.display_name %>
    <% unless @variable.units.blank? %><span class="add-on"><%= @variable.units %></span><% end %>
  </div>
<% when 'date' %>
  <%= text_field_tag "variables[#{@variable.id}]", (Date.parse(response).strftime('%m/%d/%Y') rescue response), class: 'datepicker', data: { object: 'dateminmax', content: @variable.description, title: @variable.display_name,
   date_hard_minimum: (@variable.date_hard_minimum.strftime('%m/%d/%Y') rescue ''), date_hard_maximum: (@variable.date_hard_maximum.strftime('%m/%d/%Y') rescue ''),
   date_soft_minimum: (@variable.date_soft_minimum.strftime('%m/%d/%Y') rescue ''), date_soft_maximum: (@variable.date_soft_maximum.strftime('%m/%d/%Y') rescue ''), missing_codes: @variable.missing_codes }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, title: @variable.display_name %>
<% when 'time' %>
  <%= text_field_tag "variables[#{@variable.id}]", (Time.parse(response).strftime('%H:%M:%S') rescue response), class: 'timepicker', data: { content: @variable.description, title: @variable.display_name, object: "condition" }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, title: @variable.display_name %>
<% when 'calculated'  %>
  <%= hidden_field_tag "variables[#{@variable.id}]", nil, disabled: disabled, data: { object: 'calculated', calculation: @variable.calculation, variable_id: @variable.id, target: "#variable_#{@variable.id}_calculation_result", name: @variable.name } %>
  <span id="variable_<%= @variable.id %>_calculation_result" rel="<%= 'popover' unless @variable.calculation.blank? %>" data-content="<tt><center><%= @variable.calculation %></center></tt><%= simple_format ("<hr/>" + @variable.description.to_s) unless @variable.description.blank? %>" data-title="<%= @variable.display_name %>" style="line-height:30px"></span>
<% when 'file' %>
  <%= file_field_tag "variables[#{@variable.id}][response_file]", data: { content: @variable.description, title: @variable.display_name, object: "condition" }, rel: "tooltip #{'popover' unless @variable.description.blank?}", disabled: disabled, title: @variable.display_name %>
  <%= hidden_field_tag "variables[#{@variable.id}][response_file][cache]" %>
<% else %>
  <%= hidden_field_tag "variables[#{@variable.id}]", nil, disabled: disabled %>
  Unsupported Variable Type <%= @variable.variable_type %>
<% end %>
