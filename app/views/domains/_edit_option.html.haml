- total_count = 0
- if @domain
  - # TODO: Refactor how sheet variables and grids are counted
  - # TODO: Make sure checkbox responses are also counted in this
  - sheet_variables_count = @domain.sheet_variables.where(response: domain_option.value).count
  - grid_count = @domain.grids.where(response: domain_option.value).count
  - checkbox_response_count = @domain.responses.where(value: domain_option.value).count
  - total_count = sheet_variables_count + grid_count + checkbox_response_count

%tr.domain-option-container{ class: "#{'fieldset_with_errors' if @domain && @domain.errors.keys.include?(:options)}" }
  %td{ style: 'vertical-align: middle;' }
    %span.glyphicon.glyphicon-move
    = hidden_field_tag 'domain[option_tokens][][domain_option_id]', domain_option.id
  %td{ style: @domain && @domain.new_record? ? 'display:none' : nil }
    = text_field_tag 'domain[option_tokens][][value]', domain_option.value, autocomplete: 'off', rel: 'tooltip', title: 'Value', class: 'form-control'
  %td
    = text_field_tag 'domain[option_tokens][][name]', domain_option.name, data: { object: 'option-name' }, autocomplete: 'off', rel: 'tooltip', title: 'Name', class: 'form-control'
  %td.hidden-xs
    %label.checkbox-inline.checkbox-radio-outline.nowrap{ class: "#{'selected' if domain_option.missing_code?}" }
      = check_box_tag "domain[option_tokens][][missing_code]", '1', domain_option.missing_code?, tabindex: '-1'
      Missing Code
  - if @project.sites.count > 1
    %td.hidden-xs
      = select_tag 'domain[option_tokens][][site_id]', options_for_select([['--All Sites--', nil]] + @project.sites.order(:name).pluck(:name, :id), domain_option.site_id), class: 'form-control', tabindex: '-1'
  %td{ style: 'vertical-align: middle;' }
    = link_to '#', class: 'btn btn-xs btn-danger-inverse', data: { object: 'remove-closest', target: '.domain-option-container', count: total_count }, tabindex: '-1' do
      %span.glyphicon.glyphicon-trash
    - if total_count > 0
      %span.text-muted
        = pluralize total_count, 'response'
        = "use#{'s' if total_count == 1}"
        this option.
