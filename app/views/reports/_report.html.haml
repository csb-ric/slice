- if @total_rows > @per_page
  .alert.alert-warning
    %button.close{ type: 'button', data: { dismiss: 'alert' }, aria: { hidden: true } } &times;
    = link_to 'previous', '#', class: 'btn btn-default btn-xs', data: { object: 'set-value', target: '#page', value: params[:page] - 1 } if params[:page] > 1
    = link_to 'next', '#', class: 'btn btn-default btn-xs', data: { object: 'set-value', target: '#page', value: params[:page] + 1 } if @per_page > 0 and params[:page] < @total_rows.to_f / @per_page

    = (params[:page] - 1) * @per_page + 1
    to
    = [params[:page] * @per_page, @total_rows].min
    out of a total of
    = number_with_delimiter @total_rows
    %br

%h3.center{ style: 'margin:0px' }= @report_title
%h5.center{ style: 'margin:0px;padding-bottom:8px' }= @report_subtitle.html_safe

.table-responsive-always.shadow-inset-left.shadow-inset-right
  %table.table.table-hover
    %col{ width: '1px' }
    %thead
      %tr
        %th
        - @table_header.each do |header|
          %th
            - if header.is_a? Hash
              %span.count-rot315{ class: "#{'text-muted' if header[:name].blank?}", rel: 'tooltip', title: header[:tooltip] }
                = header[:name].blank? ? 'Unknown' : header[:name].truncate(10)
            - else
              = header
    %tfoot
      %tr{ style: 'font-weight:bold' }
        - @overall_min = @table_footer[:values].min
        - @overall_max = @table_footer[:values].max
        %td
          %span{ style: 'display:none', data: { object: 'sparkline', type: @table_footer[:chart_type], values: @table_footer[:values], min: @overall_min, max: @overall_max } }
            = @table_footer[:values].join(',')
        - @table_footer[:cells].each do |hash|
          - if hash[:colspan].blank?
            %td
              %span{ class: "#{'text-muted' if hash[:count] == nil}", rel: 'tooltip', title: hash[:tooltip], data: { placement: 'right' } }
                %span.rounded-borders{ style: 'background-color: transparent' }
                  - link_name = @design ? project_sheets_path(@project, design_id: @design.id, f: hash[:filters]) : project_sheets_path(@project, f: hash[:filters])
                  = '&plusmn;'.html_safe if hash[:symbol] == 'pm' and hash[:name] != '-'
                  = link_to_if(hash[:count].to_i > 0, hash[:name], link_name, target: '_blank')
                - unless hash[:debug].blank?
                  = hash[:filters].collect{|f| "#{f[:variable_id]}:#{f[:value]}:#{f[:start_date]}:#{f[:end_date]}"}
                  = hash[:calculation]
                - if @table_footer[:chart_type] == 'line' and hash[:count]
                  - if @percent == 'row' and hash[:count] > 0 and @table_footer[:values].sum > 0 and hash[:column_type] != 'total'
                    %span.text-muted{ style: 'font-size:0.7em' }
                      = (hash[:count] * 100 / @table_footer[:values].sum).to_s + '%'
          - else
            %td{ colspan: (hash[:colspan].blank? ? 1 : hash[:colspan]) }
              = hash[:name]
    %tbody
      - @table_body.each do |row|
        %tr
          %td
            %span{ style: 'display:none', data: { object: 'sparkline', type: row[:chart_type], values: row[:values], min: @overall_min, max: @overall_max } }
              = row[:values].join(',')
          - row[:cells].each_with_index do |hash, index|
            %td
              - reverse_index = index - row[:cells].size + 1
              - column_count = reverse_index == 0 ? @table_footer[:values].sum : @table_footer[:values][reverse_index]
              %span{ class: "#{'text-muted' if hash[:count] == nil}", rel: 'tooltip', title: hash[:tooltip], data: { placement: 'right' } }
                %span.rounded-borders{ class: "#{'text-muted' if hash[:name].blank?}", style: 'background-color: transparent' }
                  - link_name = @design ? project_sheets_path(@project, design_id: @design.id, f: hash[:filters]) : project_sheets_path(@project, f: hash[:filters])
                  = '&plusmn;'.html_safe if hash[:symbol] == 'pm' and hash[:name] != '-'
                  - if hash[:name].blank?
                    Unknown
                  - else
                    - if not hash[:link].blank?
                      = link_to hash[:name], root_path + hash[:link]
                    - else
                      = link_to_if hash[:count].to_i > 0, hash[:name], link_name, target: '_blank'

                - unless hash[:debug].blank?
                  = hash[:filters].collect{|f| "#{f[:variable_id]}:#{f[:value]}:#{f[:start_date]}:#{f[:end_date]}"}
                  = hash[:calculation]

                - if row[:chart_type] == 'line' and hash[:count]
                  - if @percent == 'row' and hash[:count] > 0 and row[:values].sum > 0 and hash[:column_type] != 'total'
                    %span.text-muted{ style: 'font-size:0.7em' }
                      = (hash[:count] * 100 / row[:values].sum).to_s + '%'
                  - if @percent == 'column' and hash[:count] > 0 and column_count and column_count > 0
                    %span.text-muted{ style: 'font-size:0.7em' }
                      = (hash[:count] * 100 / column_count).to_s + '%'

.center.text-muted= @report_caption

- link_name = @design ? project_reports_design_advanced_path(@design.project, @design, percent: @percent, f: params[:f]) : report_reports_project_path(@project, f: params[:f])
= link_to '#permalink', link_name, class: 'pull-right', rel: 'tooltip', title: 'Right-click and Copy Link Address', data: { placement: 'left' } unless params[:action] == 'report_print'
