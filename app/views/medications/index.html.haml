- @title = "Medications"
- @menu_title = "#{@project.name} #{@subject.name} #{@title}"

- content_for :sidebar, render("subjects/sidebar")

- content_for :header do
  - if @subject.editable_by?(current_user)
    .float-right
      = link_to plus_or("Add Medication"), new_project_subject_medication_path(@project, @subject), class: "btn btn-accent btn-shadow"
      = link_to plus_or("Start Medication Review"), review_medications_project_subject_path(@project, @subject), class: "btn btn-accent btn-shadow #{"disabled" if @subject.medications.blank?}"
      =# link_to plus_or("Edit Medications"), edit_medications_project_subject_path(@project, @subject), class: "btn btn-accent btn-shadow"
  = @title

- content_for :breadcrumbs do
  = render "layouts/per_page_breadcrumbs", per_page: 20, object_count: @medications.total_count
  %ol
    %li= link_to @subject.subject_code, [@project, @subject]
    %li.breadcrumb-muted medications

.mb-3.alert.alert-info Display medications as cards

- if @medications.present?
  .dashboard-container.dashboard-table
    %table.table.table-striped.table-borderless.table-hover.table-sticky
      %thead
        %tr
          %th Project
          %th Subject
          %th Position
          %th Name
          %th Start date fuzzy
          %th Stop date fuzzy
          %th{ colspan: 3 }

      %tbody
        - @medications.each do |medication|
          %tr
            %td= medication.project_id
            %td= medication.subject_id
            %td= medication.position
            %td= medication.name
            %td
              = medication.start_date_fuzzy
              = medication.fuzzy_pretty(:start_date_fuzzy)
            %td
              = medication.stop_date_fuzzy
              = medication.fuzzy_pretty(:stop_date_fuzzy)
            %td= link_to "Show", [medication.project, medication.subject, medication]
            %td= link_to "Edit", edit_project_subject_medication_path(medication.project, medication.subject, medication)
            %td= link_to "Destroy", [medication.project, medication.subject, medication], method: :delete, data: { confirm: "Delete #{medication.name}?" }
  .center-horizontally= paginate @medications, theme: "bootstrap"
- else
  .jumbotron.jumbotron-custom-text
    = icon("fas", "file-prescription")
    No medications entered for this subject.
