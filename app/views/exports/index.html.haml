- @title = "Exports"
- @menu_title = "#{@project.name} #{@title}"

- content_for :container_class, "container-fluid"
- content_for :sidebar, render("projects/sidebar")

- content_for :header do
  .float-right
    = link_to plus_or("New Export"), new_project_export_path(@project), class: "btn btn-accent btn-shadow"
    .per-page= render "layouts/per_page", per_page: 20, object_count: @exports.total_count
  = @title

.dashboard-container
  %table.table.table-striped.table-borderless.table-hover
    %col{ width: "1px" }
    %col
    %col.d-none.d-sm-table-column
    %col.d-none.d-md-table-column{ width: "1px" }
    %col.d-none.d-sm-table-column{ width: "1px" }
    %col{ width: "1px" }
    %thead
      %tr
        = th_sort_field @order, "exports.status", ""
        = th_sort_field @order, "exports.created_at", "Exported"
        %th.d-none.d-sm-table-cell Type
        = th_sort_field_rev @order, "exports.file_size", "Size", extra_class: "d-none d-md-table-cell"
        %th.d-none.d-sm-table-cell File
        %th Actions

    - @exports.each do |export|
      %tr
        %td
          %span.label{ class: "label-#{export.status == "ready" ? "success" : (export.status == "pending" ? "warning" : "danger")}" }
            = export.status
        %td.nowrap
          = link_to [@project, export], rel: "tooltip", data: { title: export.created_at.strftime("%-l:%M %p"), container: "body", placement: "left" } do
            = export.created_at.strftime("%b %-d, %Y")
        %td.d-none.d-sm-table-cell{ style: "line-height: 26px;" }
          - if export.include_csv_labeled? && export.include_csv_raw?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "CSV Labeled & Raw", container: "body", placement: "top" } } CSVs
          - elsif export.include_csv_labeled?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "CSV Labeled", container: "body", placement: "top" } }  CSV
          - elsif export.include_csv_raw?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "CSV Raw", container: "body", placement: "top" } }  CSV
          - if export.include_pdf?
            %span.label.label-quiet PDF
          - if export.include_files?
            %span.label.label-quiet Files
          - if export.include_data_dictionary?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "Data Dictionary", container: "body", placement: "top" } } DD
          - if export.include_sas?
            %span.label.label-quiet SAS
          - if export.include_r?
            %span.label.label-quiet R
          - if export.include_xls?
            %span.label.label-quiet XLS
          - if export.include_adverse_events?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "Adverse Events", container: "body", placement: "top" } } AEs
          - if export.include_randomizations?
            %span.label.label-quiet{ rel: "tooltip", data: { title: "Randomizations", container: "body", placement: "top" } }
              %i.fa.fa-random>
          - if export.filters.present?
            - export.filters.split(" ").each do |filter|
              %code.d-none.d-md-inline= filter

        %td.d-none.d-md-table-cell
          - if export.file_size.positive?
            %code.nowrap= number_to_human_size(export.file_size)
        %td.d-none.d-sm-table-cell
          - if export.file_size.positive?
            - full_url = file_project_export_path(@project, export)
            = link_to full_url, target: "_blank", class: "btn btn-light btn-sm" do
              zip
              %i.fa.fa-download
        %td
          .dropdown
            = link_to "#", class: "btn btn-light btn-sm dropdown-toggle", data: { toggle: "dropdown" } do
              Actions
              %strong.caret

            %ul.dropdown-menu.dropdown-menu-right
              - if export.file_size.positive?
                - full_url = file_project_export_path(@project, export)
                %li
                  = link_to full_url, target: "_blank" do
                    %i.fa.fa-download
                    Download
                %li.divider{ role: "separator" }
              %li
                = link_to [@project, export], method: :delete, data: { confirm: "Delete #{export.name}?" } do
                  .text-danger
                    %i.fa.fa-trash
                    Delete

.center-horizontally= paginate @exports, theme: "bootstrap"
