<% @title = "Project: #{@project.name}" %>
<div class="page-header">
  <% if @project.logo.size > 0 %>
  <div onmouseover="$('#project_logo_delete_icon').show();" onmouseout="$('#project_logo_delete_icon').hide();" style="float:right" id="logo_container">
    <div style="float:right;background-color:white">
      <%= image_tag @project.logo_url, style: "height:128px" %>
    </div>
    <div id="project_logo_delete_icon" style="float:right;clear:right;display:none">
      <%= number_to_human_size(@project.logo.size) %>
      <% if current_user.all_projects.pluck(:id).include?(@project.id) %>
        <%= link_to 'remove logo', remove_file_project_path(@project), method: :post, remote: true, class: 'btn btn-mini btn-danger', data: { confirm: "Are you sure you want to remove the project logo?" } %>
      <% end %>
    </div>
  </div>
  <% end %>
  <h1><%= @title %></h1>
  <div class="btn-toolbar">
    <% if current_user.all_projects.pluck(:id).include?(@project.id) %>
      <div class="btn-group"><%= link_to "Edit Project", edit_project_path(@project), class: 'btn btn-mini' %></div>
      <div class="btn-group"><%= link_to "Delete Project", @project, method: :delete, class: 'btn btn-mini btn-danger', data: { confirm: "Are you sure you want to delete Project #{@project.name}?" } %></div>
    <% end %>

    <div class="btn-group">
      <%= link_to "Sites", sites_path(project_id: @project.id), class: 'btn btn-mini' %>
      <button class="btn dropdown-toggle btn-mini" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li><%= link_to 'Create', new_site_path(site: { project_id: @project.id }) %></li>
      </ul>
    </div>

    <div class="btn-group">
      <%= link_to "Subjects", subjects_path(project_id: @project.id), class: 'btn btn-mini' %>
      <button class="btn dropdown-toggle btn-mini" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li><%= link_to 'Create', new_subject_path(subject: { project_id: @project.id }) %></li>
      </ul>
    </div>

    <div class="btn-group">
      <%= link_to "Sheets", sheets_path(project_id: @project.id), class: 'btn btn-mini' %>
      <button class="btn dropdown-toggle btn-mini" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li><%= link_to 'Create', new_sheet_path(sheet: { project_id: @project.id }) %></li>
      </ul>
    </div>

    <div class="btn-group">
      <%= link_to "Designs", designs_path(project_id: @project.id), class: 'btn btn-mini' %>
      <button class="btn dropdown-toggle btn-mini" data-toggle="dropdown">
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li><%= link_to 'Create', new_design_path(design: { project_id: @project.id }) %></li>
      </ul>
    </div>

  </div>
</div>

<dl class="dl-horizontal">
  <dt>Name</dt>
  <dd><%= @project.name %></dd>

  <dt>Description</dt>
  <dd><%= simple_format @project.description %></dd>

  <dt>Creator</dt>
  <dd><%= link_to @project.user.name, @project.user if @project.user %></dd>

  <dt>Emails</dt>
  <dd><%= @project.emails %></dd>

  <dt>Acrostic enabled</dt>
  <dd><%= simple_check @project.acrostic_enabled? %></dd>
</dl>

<div class="page-header">
  <h2>Sites</h2>
</div>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Site</th>
      <th>Prefix</th>
      <th>Subject Code Range</th>
      <th>Subjects</th>
    </tr>
  </thead>
  <tbody>
    <% @project.sites.order('name').each do |site| %>
    <tr>
      <td><%= link_to site.name, site %></td>
      <td><%= site.prefix %></td>
      <td>
        <% if site.code_minimum.blank? and site.code_maximum.blank? %>
          <span class="muted">No Range</span>
        <% elsif not site.code_minimum.blank? and site.code_maximum.blank? %>
          Starts at <%= site.code_minimum %>
        <% elsif site.code_minimum.blank? and not site.code_maximum.blank? %>
          Ends at <%= site.code_maximum %>
        <% else %>
          <%= site.code_minimum %> to <%= site.code_maximum %>
        <% end %>
      </td>
      <td><%= link_to site.subjects.count, subjects_path(project_id: @project.id, site_id: site.id) %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<div class="page-header">
  <h2>Designs</h2>
</div>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Design</th>
      <th>Sheets</th>
    </tr>
  </thead>
  <tbody>
    <% @project.designs.order('name').each do |design| %>
    <tr>
      <td><%= link_to design.name, design %></td>
      <td><%= link_to Sheet.current.where(project_id: @project.id, design_id: design.id).count, sheets_path(project_id: @project.id, design_id: design.id) %></td>
    </tr>
    <% end %>
  </tbody>
</table>


<div class="page-header">
  <h2>Sharing</h2>
</div>

<div class="row">
  <% ['librarians', 'members'].each do |relation, librarian| %>
    <div class="span6">
      <% @relation = relation; @librarian = librarian %>
      <% @users = User.current.order('last_name, first_name') %>
      <p>
        <div id="<%= @relation %>_list"><%= render partial: 'project_users/index' %></div>
      </p>
    </div>
  <% end %>
</div>
