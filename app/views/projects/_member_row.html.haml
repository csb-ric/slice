%tr{ class: "#{'success' if @member == member}" }
  - if member.user
    %td= link_to member.user.name, member.user
  - else
    %td
      %span.text-muted= member.invite_email
      - if member.is_a? ProjectUser
        = text_field_tag 'member_invite', "#{ENV['website_url']}/invite/#{member.invite_token}", class: 'form-control' if current_user == member.creator
      - else
        = text_field_tag 'member_invite', "#{ENV['website_url']}/site-invite/#{member.invite_token}", class: 'form-control' if current_user == member.creator
  %td
    = member.is_a?(ProjectUser) ? 'Project' : 'Site'
    = member.editor? ? 'Editor' : 'Viewer'
  - if @project.blinding_enabled?
    %td.center
      - if member.unblinded?
        %span.glyphicon.glyphicon-eye-open.text-muted
      - else
        %span.glyphicon.glyphicon-eye-close.text-danger
  %td.text-muted
    - if member.creator
      = link_to member.creator.name, member.creator

  %td
    - if member.is_a? ProjectUser
      = link_to 'Remove', member, method: :delete, remote: true, class: 'btn btn-xs btn-danger-inverse', data: { confirm: "Are you sure you want to remove #{member.user ? member.user.name : member.invite_email}?" } if @project.editable_by?(current_user) || (current_user.all_viewable_projects.include?(@project) && current_user == member.user)
      = link_to 'Resend Invitation', resend_project_user_path(member), method: :post, remote: true, class: 'btn btn-primary btn-xs', autocomplete: "off", data: { loading_text: "Resent" } if @project.editable_by?(current_user) && member.user.nil?
      - if @project.editable_by?(current_user) && @project.blinding_enabled? && @project.unblinded?(current_user)
        - if member.unblinded?
          = link_to 'Set as Blinded', project_user_path(member, project_id: @project.id, unblinded: '0'), method: :patch, class: 'btn btn-xs btn-primary'
        - else
          = link_to 'Set as Unblinded', project_user_path(member, project_id: @project.id, unblinded: '1'), method: :patch, class: 'btn btn-xs btn-primary'
    - else
      = link_to 'Remove', [member.project, member], method: :delete, remote: true, class: 'btn btn-xs btn-danger-inverse', data: { confirm: "Are you sure you want to remove #{member.user ? member.user.name : member.invite_email} from Site #{member.site.name}?" } if @project.editable_by?(current_user) || (current_user.all_viewable_sites.include?(member.site) && current_user == member.user)
      = link_to 'Resend Invitation', resend_project_site_user_path(member.project, member), method: :post, remote: true, class: 'btn btn-primary btn-xs', autocomplete: "off", data: { loading_text: "Resent" } if @project.editable_by?(current_user) && member.user.nil?
      - if @project.editable_by?(current_user) && @project.blinding_enabled? && @project.unblinded?(current_user)
        - if member.unblinded?
          = link_to 'Set as Blinded', project_site_user_path(@project, member, unblinded: '0'), method: :patch, class: 'btn btn-xs btn-primary'
        - else
          = link_to 'Set as Unblinded', project_site_user_path(@project, member, unblinded: '1'), method: :patch, class: 'btn btn-xs btn-primary'
