<% @title = "#{@project.name}" %>

<%= render partial: 'projects/link_bar', locals: { title: 'Setup' } %>

<div class="row">
  <div class="col-md-10">
    <div class="row">
      <div class="col-sm-12">
        <%= render partial: 'projects/show/designs' %>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <%= render partial: 'projects/show/events' %>
      </div>
      <div class="col-sm-6">
        <%= render partial: 'projects/show/schedules' %>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <%= render partial: 'projects/menu', locals: { location: 'setup' } %>
  </div>
</div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Edit Project</h3>
  </div>
  <div class="panel-body">
    <p>Click here to edit the project name, project description, and to set optional project widgets like news, documents, and contacts for the project about page.</p>
    <div><%= link_to "Edit Project", edit_project_path(@project), class: 'btn btn-default' %></div>
  </div>
</div>

<% if @project.user == current_user and @project.users.size > 0 %>
  <div class="panel panel-danger">
    <div class="panel-heading">
      <h3 class="panel-title">Transfer Ownership</h3>
    </div>
    <div class="panel-body">
      <p>Click here to transfer the project ownership to another user. This will make you an editor on the project.</p>
      <div><%= link_to 'Transfer Ownership', '#', data: { object: 'modal-show', target: "#project_#{@project.id}_transfer_modal" }, class: 'btn btn-danger-inverse' %></div>
    </div>
  </div>

  <div class="modal" id="project_<%= @project.id %>_transfer_modal">
    <div class="modal-dialog modal-wide-width">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Transfer Ownership of <%= @project.name %></h4>
        </div>
        <div class="modal-body">
          <%= form_tag transfer_project_path(@project), method: :post, id: 'transfer_project_form', class: 'form-horizontal' do %>
            <div class="form-group">
              <%= label :user_id, 'Transfer To', class: 'col-md-2 control-label' %>
              <% project_users = @project.users.order('last_name, first_name') - [current_user] %>
              <div class="col-md-10">
                <%= select_tag :user_id, options_for_select([['---', nil]] + project_users.collect{|u| [u.reverse_name, u.id]}), class: 'form-control' %>
              </div>
            </div>
          <% end %>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <%= button_tag 'Transfer Ownership', data: { object: 'submit', target: '#transfer_project_form' }, class: 'btn btn-danger-inverse' %>
        </div>
      </div>
    </div>
  </div>

<% end %>

<div class="panel panel-danger">
  <div class="panel-heading">
    <h3 class="panel-title">Delete Project</h3>
  </div>
  <div class="panel-body">
    <p>By deleting the project, you will no longer have access to any of the data collected. Deleting the project removes it for all users on the project.</p>

    <p>If you wish to remove yourself from the project, you can alternatively remove yourself under the <%= link_to 'Share', share_project_path(@project), class: 'btn btn-xs btn-default' %> link instead<% if @project.user == current_user and @project.users.size > 0 %>, or if you are the project creator, you can transfer ownership to another user on the project<% end %>.</p>
    <div><%= link_to "Delete Project", @project, method: :delete, class: 'btn btn-danger', data: { confirm: "Are you sure you want to delete Project #{@project.name}?" } %></div>
  </div>
</div>
